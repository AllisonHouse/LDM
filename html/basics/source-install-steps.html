<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
    <meta name="UIINDEX" content="4">
   <meta name="BOOKMARK" content="Source Install Steps">
   <meta name="AUTHOR" content="steve">
   <meta name="KEYWORDS" content="LDM, install, installation, source">
   <title>LDM Source-Code Installation</title>
</head>
<body>

<h1 align="center">LDM Source-Code Installation</h1>       

<h2>Steps:</h2>

<ol>
    <li><a href="#become">Become the LDM user<a>

    <li><a href="#obtain">Obtain the distribution</a></li>

    <li><a href="#unpack">Unpack the distribution</a></li>

    <li><a href="#build">Build and install the distribution</a></li>

    <li><a href="vet-ldmadmin.html">Vet the <code><b>ldmadmin</b></code>
	configuration-file</a>

    <LI><a href="#subdirs">Create the appropriate subdirectory structure</a>
	only if you do not already have an LDM installation
</ol>

<hr><a NAME="become"></a>
<h2>Become the LDM User</h2>

<p>Follow
<a href="become_ldm.html">this advice</a> on becoming the 
<a href="glindex.html#LDM user">LDM user</a>.

<p><a href="../workshop/specifics.html#becomeLdmUser">Workshop-specific instructions</a>.

<hr><a NAME="obtain"></a>
<h2>
Obtain the 
<a href="glindex.html#LDM">LDM</a> Source-Distribution</h2>

<p>The 
<a href="glindex.html#LDM">LDM</a> 
source-distribution can be obtained by clicking on the appropriate link in the 
<a href="/downloads/ldm/">LDM download page</a>.
Download the file into the 
<a href="glindex.html#LDM user">LDM user</a>'s home directory.

<p>The remaining instructions assume that the distribution was downloaded 
into the 
<a href="glindex.html#LDM user">LDM user</a>'s home-directory.</p>

<a NAME="unpack"></a>
<hr>
<h2>Unpack the Distribution</h2>

<p>Unpack the distribution in the 
<a href="glindex.html#LDM user">LDM user</a>'s home directory
using the <b><code>gunzip(1)</code></b> and <b><code>tar(1)</code></b>
utilities.
For example:
<blockquote><pre>
cd                                     # go to the LDM user's home-directory
gunzip -c ldm-6.8.1.tar.gz | tar xvf - # unpack the distribution
</pre></blockquote>

The name of the
subdirectory will contain the version identifier of the just-unpacked package
(<i>e.g.</i>, <tt><b>ldm-6.8.1</b></tt>).  For the meaning of
the version identifier, see
<a href="versionId.html">The LDM Version Identifier</a>.

<p>Assign the pathname of the version subdirectory to the shell variable
<b><code>VDIR</code></b>, <i>e.g.</i>,
<blockquote><pre>
VDIR=ldm-6.8.1
</blockquote></pre>
This will be useful later.

<hr><a NAME="build"></a>
<h2>
Build and Install the Distribution</h2>

<ol>

<li><p>Go to the top-level directory of the just-unpacked package:
<blockquote><pre>
cd $HOME/$VDIR
</pre></blockquote>
</p></li>

<a name="clean-up"></a>
<li><p>If you need to clean-up from a previous build attempt, then 
use the <b><code>make(1)</code></b> utility to return the 
distribution to a pristine state:
<blockquote><pre>
make distclean
</pre></blockquote>
Don't worry if this command fails or even fails to execute.</li>

<a name="environment-variables"></a>
<li><p>(Optional) If necessary, override the default values for certain
build-configuration parameters by setting the associated environment
variables.  The environment variables that you may set include the
following:
<blockquote>
<table align="center" border="2" cellpadding="6" cellspacing="0">
    <tr>
	<th>Variable</th>
	<th>Meaning</th>
	<th>Example Value</th>
    </tr>
	<td><code>CC</code></td>
	<td>C compiler</td>
	<td><code>/usr/gnu/bin/gcc</code></td>
    </tr>
    <tr>
	<td><code>CPPFLAGS</code></td>
	<td >C preprocessor options</td>
	<td><code>-DNDEBUG</code></td>
    </tr>
    <tr>
	<td><code>CFLAGS</code></td>
	<td >C compiler options</td>
	<td><code>-O3</code></td>
    </tr>
    <tr>
	<td><code>LIBS</code></td>
	<td >Libraries to use</td>
	<td><code>-lrpcsoc</code></td>
    </tr>
</table>
</blockquote>
Normally, this step should not be necessary.

<p>How to set an environment variable depends on your user-shell.  For
example:
<blockquote>
<table align="center" border="2" cellpadding="6" cellspacing="0">
    <tr>
	<th>User Shell</th>
	<th>Example</th>
    </tr>
	<td>Standard UNIX<sup>®</sup> (e.g. <code>sh, ksh, bash</code>)</td>
	<td nowrap><code>export CC=/usr/gnu/bin/gcc</code></td>
    </tr>
    <tr>
	<td><code>csh</code>-like (e.g. <code>csh, tcsh</code>)</td>
	<td nowrap><code>setenv CC /usr/gnu/bin/gcc</code></td>
    </tr>
</table>
</blockquote>

<p><b>NOTE: Because of the following step, you should unset all
of the above environment variables that you don't explicitly use.
In particular, you should probably not set any of the above
environment variables in your shell's profile-file.</b>

<li>
<p>Decide if the
<a href="glindex.html#LDM">LDM</a> system needs to support
a small <a href="glindex.html#product-queue">product-queue</a> from a
previous installation.  By default, the build procedure will create an
<a href="glindex.html#LDM">LDM</a> system that supports a
64-bit <a href="glindex.html#product-queue">product-queue</a>,
which can be up to (2^64)-1 bytes in size (if that is possible on your
computer system).  This aspect of the 
<a href="glindex.html#LDM">LDM</a>
is different from version 6.1 (and earlier versions) which required
manual modification of the build procedure in order to support a large
<a href="glindex.html#product-queue">product-queue</a>.
It could be, however, that you wish to continue to use the
32-bit <a href="glindex.html#product-queue">product-queue</a>
created by a 6.1 (or earlier) version of the
<a href="glindex.html#LDM">LDM</a>,
in which case, you should specify the option 
<code><b>--disable-max-size</b></code>
when executing the <b><code>configure</code></b> script.  This will result in an
<a href="glindex.html#LDM">LDM</a>
system that will continue to work with the previously-existing
<a href="glindex.html#product-queue">product-queue</a>.

<p><a href="#pqcheck">Step 7</a>, below, contains related information.

<li>
<p><a name="run configure script"></a>
Run the <b><code>configure</code></b> script.  You may use the following
options, when and if appropriate:
<blockquote>
<dl>
    <p><dt><code>--disable-max-size</code>
    <dd>Disables any attempt to maximize the size of the 
	programming-environment.  Use of this option depends on your
	decision from the previous step and
	<a href="platform.html#development">
	whether or not it's necessary given your platform and C compiler</a>.
	The default is to try to maximize the integer, long, pointer and 
	<code>off_t</code> programming-environment in order to support
	large
	<a href="glindex.html#product-queue">product-queue</a>s.

    <p><dt><code>--enable-logging=<a href="glindex.html#localn">local<i>n</i>
	</a>
    <dd>Configures the <a href="glindex.html#LDM">LDM</a> to use the
	<a href="glindex.html#localn">local<i>n</i></a>
	facility for logging messages.  If you have a previous 
	<a href="glindex.html#LDM">LDM</a>
	installation, then you should use the same facility.
	The default is to use the
	<code><b>local0</b></code> facility.
</dl>
</blockquote>

<p>Redirect <em>both</em> standard output
and standard error to the file <b><code>configure.log</code></b>.
The relevant command depends on your user-shell.  For example:
<blockquote>
<table align="center" border="2" cellpadding="6" cellspacing="0">
    <tr>
	<th>User Shell</th>
	<th>Example</th>
    </tr>
	<td>Standard UNIX<sup>®</sup> (e.g. <code>sh, ksh, bash</code>)</td>
	<td><code>./configure&nbsp;...&nbsp;>configure.log&nbsp;2>&1</code><br>
	</td>
    </tr>
    <tr>
	<td><code>csh</code>-like (e.g. <code>csh, tcsh</code>)</td>
	<td><code>./configure&nbsp;&nbsp;...&nbsp;>&!&nbsp;configure.log</code><br>
	</td>
    </tr>
</table>
</blockquote>
This step customizes the installation process for your particular
system.
</li>

<p>Inspect the file <b><code>configure.log</code></b> to verify the
configuration process.
If an error occurred, then the reason for the error can often be found
in the file <b><code>config.log</code></b> (note the slightly different name).<p>
<p>If you email the 
<a href="glindex.html#UPC">UPC</a>
because of a problem with this step, be sure to
enclose the files <b><code>configure.log</code></b> and 
<b><code>config.log</code></b>.</p>
</li>

<li>
<p>Use the 
<a href="platform.html#development"><b><code>make(1)</code></b> utility
appropriate for your system</a> to build the package,
redirecting <em>both</em> standard output
and standard error to the file <b><code>make.log</code></b>.
The relevant command depends on your user shell.  For example:
<blockquote>
<table align="center" border="2" cellpadding="6" cellspacing="0">
    <tr>
	<th>User Shell</th>
	<th>Command</th>
    </tr>
	<td>Standard UNIX<sup>®</sup> (e.g. <code>sh, ksh, bash</code>)</td>
	<td nowrap><code><a href="platform.html#development">make</a>
	    &gt;make.log 2>&1</code></td>
    </tr>
    <tr>
	<td><code>csh</code>-like (e.g. <code>csh, tcsh</code>)</td>
	<td nowrap><code><a href="platform.html#development">make</a>
	    &gt;&! make.log</code></td>
    </tr>
</table>
</blockquote>

This step creates the package libraries and programs but doesn't install 
them.</p>

<p>Inspect the file <b><code>make.log</code></b> to verify the
build process.  If something went wrong that you think might be fixed by
<a href="#environment-variables">setting an environment variable</a>
(such as using the <b><code>cc</code></b> compiler rather than the
<b><code>c89</code></b> compiler) then return to the
<a href="#clean-up">clean-up step</a> above.

<p>If you email the 
<a href="glindex.html#UPC">UPC</a>
because of a problem with this step, be sure to
enclose the files <b><code>configure.log</code></b>, 
<b><code>config.log</code></b>, and
<b><code>make.log</code></b>.</p>
</li>

<li><a name="pqcheck"></a>
<p>(Optional) If you decided that the just-built
<a href="glindex.html#LDM">LDM</a> system should work with the previous
<a href="glindex.html#product-queue">product-queue</a>
from a version 6.1 (or earlier)
<a href="glindex.html#LDM">LDM</a>, then verify that it
does so by executing the command 
<blockquote><pre>
pqcheck/pqcheck
</blockquote></pre>
If this indicates that the
<a href="glindex.html#product-queue">product-queue</a> is invalid, then
you must either 
rebuild this package -- starting with the
<a href="#clean-up">clean-up step above</a> --
and specify the 
<code><b>--disable-max-size</b></code>
option to the <code><b>configure</b></code> script when it is executed, or
you will have to remove the previous 
<a href="glindex.html#product-queue">product-queue</a> and
create a new, empty one using the programs of this package before starting
the new LDM.

<li>
<p>Use the <a href="platform.html#development"><b><code>make</code></b>
utility appropriate for your system</a> to install the package components,
redirecting <em>both</em> standard output
and standard error to the file <b><code>install.log</code></b>.
The relevant command depends on your user shell.  For example:
<blockquote>
<table align="center" border="2" cellpadding="6" cellspacing="0">
    <tr>
	<th>User Shell</th>
	<th>Command</th>
    </tr>
	<td>Standard UNIX<sup>®</sup> (e.g. <code>sh, ksh, bash</code>)</td>
	<td nowrap><code><a href="platform.html#development">make</a>
	    install &gt;install.log 2>&1</code></td>
    </tr>
    <tr>
	<td><code>csh</code>-like (e.g. <code>csh, tcsh</code>)</td>
	<td nowrap><code><a href="platform.html#development">make</a>
	    install &gt;&! install.log</code></td>
    </tr>
</table>
</blockquote>
</p>

<p>Inspect the file <b><code>install.log</code></b> to verify the
installation process.  Ignore all errors that <b><code>make</code></b>, itself,
ignores.</p>

<p>If you email the 
<a href="glindex.html#UPC">UPC</a>
because of a problem with this step, be sure to
enclose the file <b><code>install.log</code></b>.</p>
</li>

<li>
<p>
Install some components with superuser privileges:
<blockquote><pre>
su root -c 'make install_setuids'
</blockquote></pre>
Note that you need the superuser's password to accomplish 
this step.
</p>

<p>This step is necessary for the 
<a href="glindex.html#LDM">LDM</a> server to listen on port 388 (which is
a restricted port) 
and for the <b><code>hupsyslog(1)</code></b> utility
to notify the <b><code>syslogd(8)</code></b> daemon when a new log-file has been
created.

<li>
<p>Use the <b><code>make(1)</code></b> utility to clean-up after yourself.
<blockquote><pre>
make clean
</blockquote></pre>
</li>

</ol>

<p><a href="../workshop/specifics.html#build">Workshop-specific instructions</a>.

<hr><a NAME="ldmadmin"></a>
<h2>Vet the <a href="glindex.html#ldmadmin"><tt>ldmadmin</tt></a> 
configuration-file</h2>

<p>
Follow <a href="vet-ldmadmin.html">these instructions</a> on vetting the
<a href="glindex.html#ldmadmin"><tt>ldmadmin</tt></a> 
configuration-file.

<hr>

<a name="subdirs"></a>
<h2>Create the appropriate subdirectory structure</h2>

    <blockquote>

    <p>
    You may skip this step if you already have an LDM installation
    (because you are upgrading your LDM, for example) because the
    directories should already exist.

    <ul>
	<li><a href="#data-and-log-dirs">Create subdirectories for data-files 
	    and LDM logfiles</a>
	<li><a href="#runtime-subdirs">Create symbolic-link subdirectories</a>
    </ul>

    <a name="data-and-log-dirs"></a>
    <h3>
    Create subdirectories for data-files and 
    <a href="glindex.html#logfile">LDM logfile</a>s</h3>

    <blockquote>

	<h4>If you back-up users' home-directories:</h4>

	<blockquote>

	    <p>The 
	    <a href="glindex.html#LDM">LDM</a>'s 
	    <a href="glindex.html#product-queue">product-queue</a> 
	    <strong>must</strong> be on a locally-mounted disk,
	    and it is highly recommended that locally-decoded and stored data
	    also be written to locally-mounted disk(s).  Also, because
	    data-files and 
	    <a href="glindex.html#logfile">LDM logfile</a>s are extremely
	    volatile, they should probably
	    not be automatically backed-up on a regular basis.
	    For these reasons, we strongly recommend that
	    the directories containing the 
	    <a href="glindex.html#logfile">LDM logfile</a>s and decoded 
	    data-files
	    be on locally-mounted but not automatically backed-up disk(s).

	    <p>If you routinely back-up users' home-directories, then the 
	    <a href="glindex.html#LDM">LDM</a>'s
	    log and data directories should not reside under the 
	    <a href="glindex.html#LDM user">LDM user</a>'s
	    home-directory but should, instead, be on other local, but not 
	    backed-up disk(s) (<i>e.g.</i>, <code>/var/data</code>).
	    In this case, you
	    must create the data and log directories (possibly as root) and 
	    ensure that they can be managed by the 
	    <a href="glindex.html#LDM user">LDM user</a> and the 
	    <a href="glindex.html#LDM user">LDM user</a>'s group.  For example:
<blockquote><pre>
su                                    # become root
cd /var/data                          # go to a non-backed-up directory
mkdir ldm ldm/data ldm/logs           # create the subdirectories
chmod -R g+w ldm                      # set group write permission
chown -R ldm:<em>groupId</em> ldm            # set group to LDM user's group
exit                                  # become LDM user
cd                                    # go to home-directory
ln -s /var/data/ldm/data .            # symbolic-link to data directory
ln -s /var/data/ldm/logs .            # symbolic-link to logging directory
</blockquote></pre>

	</blockquote>

    <h4>If you don't back-up users' home-directories:</h4>

	<blockquote>

	    <p>If you don't routinely back-up users' home-directories,
	    then you may simply create the necessary directories in the 
	    <a href="glindex.html#LDM user">LDM user</a>'s
	    home-directory.  For example:
<blockquote><pre>
cd                                   # go to home-directory
mkdir data logs                      # create data and logging subdirectories
</blockquote></pre>

	</blockquote>

    <p><a href="../workshop/specifics.html#dataAndLogDirs">Workshop-specific
    instructions</a>.

    </blockquote>

<a name="runtime-subdirs"></a>
<h3>Create symbolic-link subdirectories</A></h3>

<blockquote>

    <p>The symbolic-link subdirectories allow for easy switching between
    different versions of an LDM installation.  Each symbolic-link
    subdirectory goes through a "runtime" symbolic-link, which, in turn,
    references the currently-active LDM installation.

    <p>Execute the following commands:

<blockquote><pre>
cd                                    # go to LDM user's home-directory
ln -s $VDIR runtime                   # create "runtime" symbolic-link
ln -s runtime/{bin,include,lib,man} . # create individual links through "runtime"
</blockquote></pre>

    <p>The directory structure should now look something like this
      (your <tt>data</tt> and <tt>logs</tt> "directories" might be different):
<blockquote><pre>
ls -lF
... bin -> runtime/bin/
... data -> /var/data/ldm/data/
... etc/
... include -> runtime/include/
... ldm-6.8.1/
... lib -> runtime/lib/
... logs -> /var/data/ldm/logs/
... man -> runtime/man/
... runtime -> ldm-6.8.1/
</blockquote></pre>


</blockquote>

<script language="JavaScript" type="text/JavaScript">
document.write(date_modified);
</script>

</body>
</html>
